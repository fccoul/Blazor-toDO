@page "/"
@using myDailyTodoList.Models;

<input @bind="newTask" type="Enter a Todo">
<button @onclick="addTask">Save</button>

<hr />
<JobsContainer Jobs="Jobs" OnStatusUpdated="HandleStatusUpdated">
    <JobList ListStatus="JobStatuses.Todo" AllowedStatuses="@(new JobStatuses[] {JobStatuses.Started,JobStatuses.Progress})" />
    <JobList ListStatus="JobStatuses.Started" AllowedStatuses="@(new JobStatuses[] {JobStatuses.Todo})" />
    <JobList ListStatus="JobStatuses.Progress" AllowedStatuses="@(new JobStatuses[] {JobStatuses.Started})" />
    <JobList ListStatus="JobStatuses.Completed" AllowedStatuses="@(new JobStatuses[] {JobStatuses.Progress})" />
</JobsContainer>
<hr/>
<p>LAst updated job was : <strong>@lastUpdatedJob</strong></p>
<nr/>
@foreach (var task in Jobs)
{
    <p>@task.Description - <strong>@task.Status</strong></p>
}

@code{
    List<JobModel> Jobs = new List<JobModel>();
    string lastUpdatedJob = "";

    protected override void OnInitialized()
    {
        Jobs.Add(new JobModel
            {
                Id = 1,
                Description = "Creating Database",
                Status = JobStatuses.Todo,
                LastUpdated = DateTime.Now
            });

        Jobs.Add(new JobModel
            {
                Id = 2,
                Description = "Desing UI",
                Status = JobStatuses.Todo,
                LastUpdated = DateTime.Now
            });

        Jobs.Add(new JobModel
            {
                Id = 3,
                Description = "DAta binding",
                Status = JobStatuses.Todo,
                LastUpdated = DateTime.Now
            });
        Jobs.Add(new JobModel
            {
                Id = 4,
                Description = "Fix All Error",
                Status = JobStatuses.Todo,
                LastUpdated = DateTime.Now
            });

        Jobs.Add(new JobModel
            {
                Id = 5,
                Description = "Support Prod",
                Status = JobStatuses.Todo,
                LastUpdated = DateTime.Now
            });
    }
    void HandleStatusUpdated(JobModel updatedJob)
    {
        lastUpdatedJob = updatedJob.Description;
    }

    string newTask{ get; set; }

    int getLastId()
    {
        return Jobs.Max(m => m.Id);
    }

    void addTask()
    {

        if(!string.IsNullOrWhiteSpace(newTask))
        {
            int valID = getLastId() + 1;
            JobModel jobModel = new JobModel { Description = newTask, Status = JobStatuses.Todo, Id = valID,LastUpdated=DateTime.Now };
            Jobs.Add(jobModel);
        }
       
    }
}
